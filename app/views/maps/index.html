<head>
<title>Geocoding with GMap v3</title>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript" src="media/js/jquery-ui-1.8.16.custom.min.js"></script>
<link href="/css/maps.css" media="screen" rel="stylesheet" type="text/css">

<script type="text/javascript">
var geocoder;
var map;
var marker;

function initialize(){
    
    var latlng = new google.maps.LatLng(41.659,-4.714);
    
    var options = {
        zoom: 16,
        center: latlng,
        mapTypeId: google.maps.MapTypeId.SATELLITE
    };
        
    map = new google.maps.Map(document.getElementById("map_canvas"), options);
        
    geocoder = new google.maps.Geocoder();
    
    marker = new google.maps.Marker({
        map: map,
        draggable: true
    });
            
}

$(document).ready(function() { 
         
    initialize();
                  
    $(function() {
        $("#address").autocomplete({

            source: function(request, response) {
            geocoder.geocode( {'address': request.term }, function(results, status) {
            response($.map(results, function(item) {
                    return {
                        label:  item.formatted_address,
                        value: item.formatted_address,
                        latitude: item.geometry.location.lat(),
                        longitude: item.geometry.location.lng()
                    }
                }));
            })
        },

        select: function(event, ui) {
                
            $("#latitude").val(ui.item.latitude);
            $("#longitude").val(ui.item.longitude);
            var location = new google.maps.LatLng(ui.item.latitude, ui.item.longitude);
            marker.setPosition(location);
            map.setCenter(location);
        }
        });
    });
</script>
  
<body>
    <label>Address: </label><input id="address"  type="text"/>
    <div id="map_canvas" style="width:300px; height:300px"></div><br/>
    <label>latitude: </label><input id="latitude" type="text"/><br/>
    <label>longitude: </label><input id="longitude" type="text"/>
</body>
